/**
 * @brief Profiling of the shared library to accelerate execution of python simulation
 * @author Yann Charbon <yann.charbon@heig-vd.ch>
 * @note See README for more information
 */

#include "CDAGOperation.h"
#include <stdio.h>
#include <vector>
#include <unistd.h>

// 18x18
/*std::vector<std::vector<float>> adj_matrix =
{
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.416211728070690679e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.517920318794439664e-02,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.096358696492506002e-01,0.000000000000000000e+00,0.000000000000000000e+00,2.325521788780014754e-01,1.972109588565997551e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.649957499103295866e-01,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.906593889219809212e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.325214962011040443e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.696585981031484003e-01,2.497662892077038843e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,8.421291680776459010e-02,0.000000000000000000e+00,9.504882107816771397e-02,3.431231921961264142e-02,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.274081601518061990e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.776148232802043092e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.987560700316808870e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,2.096358696492506002e-01,0.000000000000000000e+00,8.421291680776459010e-02,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,8.692037410868941327e-02,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.154217533097957188e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,1.906593889219809212e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,3.372879100790138196e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.146209938095211350e-01,4.119911366444971301e-02,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {1.416211728070690679e-01,0.000000000000000000e+00,0.000000000000000000e+00,9.504882107816771397e-02,0.000000000000000000e+00,0.000000000000000000e+00,3.372879100790138196e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.274790214811856170e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,2.325521788780014754e-01,0.000000000000000000e+00,3.431231921961264142e-02,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.931081744564554503e-01,2.631098775846534843e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,1.972109588565997551e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,8.692037410868941327e-02,0.000000000000000000e+00,0.000000000000000000e+00,2.631098775846534843e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.200378662340219615e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,2.325214962011040443e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.156424405195498106e-01},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.274790214811856170e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.927850211592835317e-02,0.000000000000000000e+00,0.000000000000000000e+00,1.481835679877755302e-05,2.578770745728512503e-01,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.776148232802043092e-01,0.000000000000000000e+00,1.146209938095211350e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.154217533097957188e-01,4.119911366444971301e-02,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {1.517920318794439664e-02,0.000000000000000000e+00,0.000000000000000000e+00,1.274081601518061990e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.481835679877755302e-05,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.271914826831221423e-01},
    {0.000000000000000000e+00,1.649957499103295866e-01,1.696585981031484003e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.578770745728512503e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.217731369648203166e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,2.497662892077038843e-01,0.000000000000000000e+00,1.987560700316808870e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,1.200378662340219615e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.217731369648203166e-01,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.156424405195498106e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.271914826831221423e-01,0.000000000000000000e+00,0.000000000000000000e+00,1.874593072758624634e-01}
};*/

// 20x20
std::vector<std::vector<float>> adj_matrix =
{
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,3.838709414618381999e-01},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.456821793952281952e-01,5.616036957217309666e-01,0.000000000000000000e+00,0.000000000000000000e+00,5.480618898963007801e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.744623027556822414e-01,0.000000000000000000e+00,5.096449253182798733e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.502211217582903768e-01,0.000000000000000000e+00,8.375818537114839701e-01},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,7.169668420431546396e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.974801389126514151e-01,6.999588026055473255e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.749506283063992251e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.419002442433861422e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.398701051304782506e-01},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,7.169668420431546396e-01,0.000000000000000000e+00,0.000000000000000000e+00,6.309570850869929970e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,7.753371691354012940e-01,0.000000000000000000e+00,5.725089218776285849e-01,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,6.309570850869929970e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.200858598764552809e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.014561663302747885e-01,5.630875315896446409e-01,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,4.744623027556822414e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.436583998234565063e-01,0.000000000000000000e+00,0.000000000000000000e+00,4.654484219566972780e-01,0.000000000000000000e+00,5.493528450757600989e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.985701622201687555e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.307928527041622102e-01,0.000000000000000000e+00,2.454274547350492608e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,5.096449253182798733e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.054196655403481175e-01,0.000000000000000000e+00,5.906957940344144120e-01,0.000000000000000000e+00,5.023165034397173434e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.200858598764552809e-01,4.436583998234565063e-01,4.985701622201687555e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.608673530857707368e-01},
    {0.000000000000000000e+00,4.456821793952281952e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.054196655403481175e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,7.053179795359143522e-01,0.000000000000000000e+00,2.519247317993582591e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,5.616036957217309666e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.013987506881059319e-01,0.000000000000000000e+00,5.093747163560936597e-01,0.000000000000000000e+00,3.719230719563304532e-01,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.974801389126514151e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.654484219566972780e-01,0.000000000000000000e+00,5.906957940344144120e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.946591971499942897e-01,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,6.999588026055473255e-01,4.419002442433861422e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.013987506881059319e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,5.480618898963007801e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,7.753371691354012940e-01,0.000000000000000000e+00,5.493528450757600989e-01,0.000000000000000000e+00,5.023165034397173434e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.014561663302747885e-01,0.000000000000000000e+00,5.307928527041622102e-01,0.000000000000000000e+00,0.000000000000000000e+00,7.053179795359143522e-01,5.093747163560936597e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,4.502211217582903768e-01,0.000000000000000000e+00,0.000000000000000000e+00,5.725089218776285849e-01,5.630875315896446409e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.946591971499942897e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,4.749506283063992251e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,2.454274547350492608e-01,0.000000000000000000e+00,0.000000000000000000e+00,2.519247317993582591e-01,3.719230719563304532e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},
    {3.838709414618381999e-01,0.000000000000000000e+00,8.375818537114839701e-01,0.000000000000000000e+00,4.398701051304782506e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,5.608673530857707368e-01,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00,0.000000000000000000e+00},

};

int main(void) {
    printf("Profiling...\n");
    int nodes_count = adj_matrix.size();

    // Convert the std::vector to a float**
    float** adj_matrix_c = new float*[nodes_count];
    for (int i = 0; i < nodes_count; ++i) {
        adj_matrix_c[i] = adj_matrix[i].data();
    }

    int generated_dags_count = 0;
    bool test_mode = false;
    Edge** results = generate_subset_dags(adj_matrix_c, nodes_count, &generated_dags_count, test_mode);

    printf("Generated %d dags\n", generated_dags_count);

    delete[] adj_matrix_c;

    free_all_possible_tree(results, generated_dags_count);

    printf("Waiting to finish...\n");
    sleep(1);
    return 0;
}